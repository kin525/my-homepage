<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="ROBOTS" content="NOARCHIVE">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Luen Hing Survey Program</title>
  <style>
    /* Base reset and responsive design */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: #f5f5f5;
      padding: 15px;
      line-height: 1.6;
      color: #333;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h3 {
      text-align: center;
      margin-bottom: 10px;
      color: #2c3e50;
      font-size: 24px;
    }

    p {
      margin-bottom: 15px;
    }

    /* Form elements */
    select, input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      margin-bottom: 10px;
      -webkit-appearance: none;
      appearance: none;
      background: white;
    }

    select:focus, input[type="text"]:focus {
      outline: none;
      border-color: #007AFF;
    }

    fieldset {
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      background: #fafafa;
    }

    legend {
      font-weight: bold;
      padding: 0 10px;
      color: #555;
    }

    /* Buttons */
    input[type="button"] {
      width: 100%;
      padding: 12px;
      background: #007AFF;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.2s;
      margin-bottom: 10px;
    }

    input[type="button"]:active {
      background: #0056cc;
      transform: scale(0.98);
    }

    /* Result section */
    .result-section {
      background: #e8f4ff;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .result-section p {
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Responsive adjustments */
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      .container {
        padding: 15px;
      }
      
      select, input[type="text"], input[type="button"] {
        padding: 10px;
        font-size: 14px;
      }
    }

    /* Number input container */
    .number-input-container {
      position: relative;
    }

    .number-input-container input {
      padding-right: 40px;
    }

    .clear-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      font-size: 18px;
      color: #999;
      cursor: pointer;
      display: none;
      padding: 5px;
      z-index: 10;
    }

    input:not(:placeholder-shown) + .clear-btn {
      display: block;
    }

    /* Number pad styles - SMALLER SIZE */
    .number-pad-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      display: flex;
      align-items: flex-end;
      justify-content: center;
    }

    .number-pad-container {
      background: white;
      width: 100%;
      max-width: 400px; /* Smaller max width */
      border-radius: 15px 15px 0 0;
      padding: 15px; /* Reduced padding */
      box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
    }

    .number-pad-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px; /* Reduced margin */
      padding-bottom: 8px; /* Reduced padding */
      border-bottom: 1px solid #eee;
    }

    .number-pad-header span {
      font-weight: bold;
      color: #333;
      font-size: 16px; /* Smaller font */
    }

    .number-pad-header button {
      background: none;
      border: none;
      font-size: 20px; /* Smaller close button */
      cursor: pointer;
      color: #666;
      padding: 5px;
    }

    .number-display {
      background: #f9f9f9;
      border: 2px solid #ddd;
      border-radius: 6px;
      padding: 12px; /* Reduced padding */
      margin-bottom: 12px; /* Reduced margin */
      font-size: 16px; /* Smaller font */
      text-align: center;
      min-height: 46px; /* Smaller height */
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: monospace;
    }

    .number-pad {
      display: grid;
      grid-template-columns: repeat(4, 1fr); /* 4 columns for more compact layout */
      gap: 8px; /* Smaller gap */
      margin-bottom: 10px;
    }

    .num-btn {
      height: 45px; /* Fixed smaller height */
      font-size: 16px; /* Smaller font */
      border: none;
      border-radius: 6px;
      background: #f0f0f0;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      -webkit-user-select: none;
      user-select: none;
    }

    .num-btn:active {
      background: #ddd;
      transform: scale(0.95);
    }

    .num-btn.zero {
      grid-column: span 2;
    }

    .num-btn.backspace {
      background: #ff6b6b;
      color: white;
    }

    .num-btn.decimal {
      background: #4ecdc4;
      color: white;
    }

    .num-btn.clear {
      background: #ffa726;
      color: white;
    }

    .num-btn.input {
      background: #007AFF;
      color: white;
    }

    @media (min-width: 768px) {
      .number-pad-overlay {
        align-items: center;
      }
      
      .number-pad-container {
        width: 350px; /* Smaller desktop width */
        border-radius: 12px;
      }
    }

    /* Input touch area */
    .input-touch-area {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
      z-index: 5;
    }

    /* Form labels */
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: #555;
    }
  </style>
  <script src="station.js"></script>
</head>

<body>
  <div class="container">
    <h3>Luen Hing Survey Program</h3>
    <p style="text-align: center; color: #666;">Email: kin525@yahoo.com.hk</p>

    <form name="STN" id="surveyForm">
      <div class="form-group">
        <label for="contractSelect">Contract Number:</label>
        <select id="contractSelect" name="contact">
          <option value="Select Site">Select Site</option>
        </select>
      </div>

      <fieldset>
        <legend>From Station</legend>
        <div class="form-group">
          <label for="fromStationSelect">Station:</label>
          <select id="fromStationSelect" name="staionselect1">
            <option value="Station Name">Station Name</option>
          </select>
        </div>
        
        <div class="number-input-container">
          <label for="stnInput">N :</label>
          <input id="stnInput" name="text2" type="text" inputmode="none" readonly placeholder="Tap to enter coordinates" size="12">
          <div class="input-touch-area" onclick="showNumberPad('stnInput', 'N Coordinate')"></div>
          <button type="button" class="clear-btn" onclick="clearInput('stnInput')">กั</button>
        </div>
        
        <div class="number-input-container">
          <label for="steInput">E :</label>
          <input id="steInput" name="text3" type="text" inputmode="none" readonly placeholder="Tap to enter coordinates" size="12">
          <div class="input-touch-area" onclick="showNumberPad('steInput', 'E Coordinate')"></div>
          <button type="button" class="clear-btn" onclick="clearInput('steInput')">กั</button>
        </div>
        
        <input type="button" value="CALL FROM SINSECTION" onclick="CALLSINDATA()">
      </fieldset>

      <fieldset>
        <legend>To Station</legend>
        <div class="form-group">
          <label for="toStationSelect">Station:</label>
          <select id="toStationSelect" name="staionselect2">
            <option value="Station Name">Station Name</option>
          </select>
        </div>
        
        <div class="number-input-container">
          <label for="nxInput">Nx :</label>
          <input id="nxInput" name="text5" type="text" inputmode="none" readonly placeholder="Tap to enter coordinates" size="12">
          <div class="input-touch-area" onclick="showNumberPad('nxInput', 'Nx Coordinate')"></div>
          <button type="button" class="clear-btn" onclick="clearInput('nxInput')">กั</button>
        </div>
        
        <div class="number-input-container">
          <label for="exInput">Ex :</label>
          <input id="exInput" name="text6" type="text" inputmode="none" readonly placeholder="Tap to enter coordinates" size="12">
          <div class="input-touch-area" onclick="showNumberPad('exInput', 'Ex Coordinate')"></div>
          <button type="button" class="clear-btn" onclick="clearInput('exInput')">กั</button>
        </div>
        
        <input type="button" value="CALL ANSWER" onclick="CALL_ANSWER()">
      </fieldset>

      <input type="button" value="RUN CALCULATION" onclick="RUNIt()">

      <div class="result-section">
        <p>
          <span>BRG =</span>
          <input name="text7" type="text" size="12" readonly style="background: #f0f0f0;">
        </p>
        <p>
          <span>DIST =</span>
          <input name="text8" type="text" size="12" readonly style="background: #f0f0f0;">
          <input type="button" value="DIFF CHECK" onclick="DIST_C()" style="width: auto; padding: 8px 12px;">
        </p>
      </div>
    </form>
  </div>

  <!-- Number Pad Overlay - Compact Design -->
  <div id="numberPadOverlay" class="number-pad-overlay" style="display: none;">
    <div class="number-pad-container">
      <div class="number-pad-header">
        <span id="currentInputLabel">Enter Number</span>
        <button type="button" onclick="hideNumberPad()">กั</button>
      </div>
      
      <div class="number-display" id="numberDisplay">0</div>
      
      <div class="number-pad" id="numberPad">
        <!-- Number pad content will be generated by JavaScript -->
      </div>
    </div>
  </div>

  <script>
    // Number pad state management
    let currentInputElement = null;
    let currentDisplayValue = '0';

    // Initialize number pad with compact layout
    function initNumberPad() {
      const numberPad = document.getElementById('numberPad');
      numberPad.innerHTML = ''; // Clear existing content
      
      // More compact layout with 4 columns
      const buttons = [
        { value: '7', display: '7' },
        { value: '8', display: '8' },
        { value: '9', display: '9' },
        { value: 'backspace', display: '?', class: 'backspace' },
        { value: '4', display: '4' },
        { value: '5', display: '5' },
        { value: '6', display: '6' },
        { value: 'clear', display: 'CLEAR', class: 'clear' },
        { value: '1', display: '1' },
        { value: '2', display: '2' },
        { value: '3', display: '3' },
        { value: 'input', display: 'INPUT', class: 'input' },
        { value: '0', display: '0', class: 'zero' },
        { value: '.', display: '.', class: 'decimal' }
      ];
      
      buttons.forEach(btn => {
        const button = document.createElement('button');
        button.textContent = btn.display;
        button.className = `num-btn ${btn.class || ''}`;
        button.onclick = () => handleNumberInput(btn.value);
        numberPad.appendChild(button);
      });
    }

    function showNumberPad(inputId, label) {
      currentInputElement = document.getElementById(inputId);
      const currentValue = currentInputElement.value;
      
      document.getElementById('currentInputLabel').textContent = label;
      
      // Set display value
      if (currentValue && currentValue !== '0') {
        currentDisplayValue = currentValue;
      } else {
        currentDisplayValue = '0';
      }
      
      updateNumberDisplay();
      document.getElementById('numberPadOverlay').style.display = 'flex';
    }

    function hideNumberPad() {
      document.getElementById('numberPadOverlay').style.display = 'none';
      currentInputElement = null;
      currentDisplayValue = '0';
    }

    function handleNumberInput(value) {
      switch(value) {
        case 'backspace':
          currentDisplayValue = currentDisplayValue.slice(0, -1);
          if (currentDisplayValue === '' || currentDisplayValue === '-') {
            currentDisplayValue = '0';
          }
          break;
          
        case 'clear':
          currentDisplayValue = '0';
          break;
          
        case 'input':
          confirmNumberInput();
          return;
          
        case '.':
          if (!currentDisplayValue.includes('.')) {
            if (currentDisplayValue === '0') {
              currentDisplayValue = '0.';
            } else {
              currentDisplayValue += '.';
            }
          }
          break;
          
        default:
          if (currentDisplayValue === '0') {
            currentDisplayValue = value;
          } else {
            currentDisplayValue += value;
          }
      }
      
      updateNumberDisplay();
    }

    function updateNumberDisplay() {
      const display = document.getElementById('numberDisplay');
      display.textContent = currentDisplayValue;
      
      // Visual feedback
      display.style.color = currentDisplayValue === '0' ? '#999' : '#333';
      display.style.fontWeight = currentDisplayValue === '0' ? 'normal' : 'bold';
    }

    function confirmNumberInput() {
      if (currentInputElement) {
        currentInputElement.value = currentDisplayValue === '0' ? '' : currentDisplayValue;
        
        // Trigger input event to update related logic
        const event = new Event('input', { bubbles: true });
        currentInputElement.dispatchEvent(event);
      }
      hideNumberPad();
    }

    function clearInput(inputId) {
      const input = document.getElementById(inputId);
      input.value = '';
      
      // Trigger input event
      const event = new Event('input', { bubbles: true });
      input.dispatchEvent(event);
    }

    // Original functions (unchanged core logic)
    function functionfirst() {
      let contractnumber = [];
      let j = 0;
      let temp = "";

      contractnumber[0] = st[1][0];

      for (let i = 2; i < st.length; i++) {
        temp = st[i][0];
        if (temp !== contractnumber[j]) {
          j++;
          contractnumber[j] = temp;
        }
      }

      let z = 0;
      for (let i = contractnumber.length - 1; i > 0; i--) {
        for (let j = i - 1; j >= 0; j--) {
          if (contractnumber[i] === contractnumber[j]) {
            z++;
            contractnumber[i] = "";
            break;
          }
        }
      }

      j = 0;
      for (let i = 0; i < contractnumber.length; i++) {
        if (contractnumber[i] !== "") {
          contractnumber[j] = contractnumber[i];
          j++;
        }
      }

      let F = contractnumber.length - z;
      const contractSelect = document.getElementById('contractSelect');
      
      // Clear existing options
      contractSelect.innerHTML = '<option value="Select Site">Select Site</option>';
      
      for (let i = 0; i < F; i++) {
        const option = new Option(contractnumber[i], contractnumber[i]);
        contractSelect.add(option);
      }
    }

    function CheckIt3(index) {
      let contactno = document.STN.contact.value;
      let countnumber = 1;
      let temp = "";
      let j = 1;

      const fromSelect = document.getElementById('fromStationSelect');
      const toSelect = document.getElementById('toStationSelect');
      
      // Clear existing options
      fromSelect.innerHTML = '<option value="Station Name">Station Name</option>';
      toSelect.innerHTML = '<option value="Station Name">Station Name</option>';

      for (let i = 0; i < st.length; i++) {
        temp = st[i][0];
        if (temp === contactno) {
          countnumber++;
          fromSelect.add(new Option(st[i][1], st[i][1]));
          toSelect.add(new Option(st[i][1], st[i][1]));
          j++;
        }
      }
    }

    function checkst(stationname, contactno) {
      let k = 0;
      for (let i = 1; i < st.length; i++) {
        let c = st[i][1];
        let d = st[i][0];
        if (c === stationname && d === contactno) {
          k = i;
        }
      }
      return k;
    }

    function CheckIt1() {
      let Name = document.STN.staionselect1.value;
      let contactno = document.STN.contact.value;
      let k = checkst(Name, contactno);
      if (k > 0) {
        document.STN.text2.value = st[k][2];
        document.STN.text3.value = st[k][3];
      }
    }

    function CheckIt2() {
      let Name = document.STN.staionselect2.value;
      let contactno = document.STN.contact.value;
      let k = checkst(Name, contactno);
      if (k > 0) {
        document.STN.text5.value = st[k][2];
        document.STN.text6.value = st[k][3];
      }
    }

    function RUNIt() {
      let stn = parseFloat(document.STN.text2.value) || 0;
      let ste = parseFloat(document.STN.text3.value) || 0;
      let nx = parseFloat(document.STN.text5.value) || 0;
      let ex = parseFloat(document.STN.text6.value) || 0;

      let brg = joint(stn, ste, nx, ex);
      let dist = jointdist(stn, ste, nx, ex);
      brg = dmscode(brg);
      dist = fix3(dist);

      document.STN.text7.value = brg;
      document.STN.text8.value = dist;
    }

    function fix3(z) {
      return Math.floor(z * 1000 + 0.5) / 1000;
    }

    function dmscode(z) {
      let d = Math.floor(z);
      let m = Math.floor((z - d) * 60);
      let s = Math.floor((((z - d) * 60 - m) * 60) * 10 + 0.5) / 10;

      if (s >= 60) {
        s -= 60;
        m += 1;
      }
      if (m >= 60) {
        m -= 60;
        d += 1;
      }

      return `${d}^${m}'${s}"`;
    }

    function jointdist(n, e, n2, e2) {
      let x = n2 - n;
      let y = e2 - e;
      return Math.sqrt(x * x + y * y);
    }

    function joint(n, e, n2, e2) {
      let x = n2 - n + 1e-12;
      let y = e2 - e;
      let brg = Math.atan(y / x) * 180 / Math.PI;
      if (x < 0) brg += 180;
      if (brg < 0) brg += 360;
      return brg;
    }

    function CALLSINDATA() {
      document.STN.text2.value = localStorage.XXN || '';
      document.STN.text3.value = localStorage.XXE || '';
    }

    function CALL_ANSWER() {
      document.STN.text5.value = localStorage.JOINT_N || '';
      document.STN.text6.value = localStorage.JOINT_E || '';
    }

    function DIST_C() {
      let HD = parseFloat(prompt("INPUT HD", ""));
      if (isNaN(HD)) return;
      
      let DIST = parseFloat(document.STN.text8.value);
      if (isNaN(DIST)) {
        alert("Please calculate DIST first");
        return;
      }
      
      let a = fix3(DIST - HD);
      alert("DIFF = " + a);
    }

    // Page load initialization
    document.addEventListener('DOMContentLoaded', function() {
      functionfirst();
      initNumberPad();
      
      // Add event listeners
      document.getElementById('contractSelect').addEventListener('change', function() {
        CheckIt3(this.selectedIndex);
      });
      
      document.getElementById('fromStationSelect').addEventListener('change', CheckIt1);
      document.getElementById('toStationSelect').addEventListener('change', CheckIt2);
      
      // Click on overlay to close number pad
      document.getElementById('numberPadOverlay').addEventListener('click', function(e) {
        if (e.target === this) {
          hideNumberPad();
        }
      });
    });
  </script>
</body>
</html>