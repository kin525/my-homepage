<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="ROBOTS" content="NOARCHIVE">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Luen Hing Survey Program</title>
  <style>
    /* 基礎重置和響應式設計 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: #f5f5f5;
      padding: 15px;
      line-height: 1.6;
      color: #333;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h3 {
      text-align: center;
      margin-bottom: 10px;
      color: #2c3e50;
      font-size: 24px;
    }

    p {
      margin-bottom: 15px;
    }

    /* 表單元素樣式 */
    select, input[type="text"] {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      margin-bottom: 10px;
      -webkit-appearance: none;
      appearance: none;
      background: white;
    }

    select:focus, input[type="text"]:focus {
      outline: none;
      border-color: #007AFF;
    }

    fieldset {
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      background: #fafafa;
    }

    legend {
      font-weight: bold;
      padding: 0 10px;
      color: #555;
    }

    /* 按鈕樣式 */
    input[type="button"] {
      width: 100%;
      padding: 12px;
      background: #007AFF;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.2s;
      margin-bottom: 10px;
    }

    input[type="button"]:active {
      background: #0056cc;
      transform: scale(0.98);
    }

    /* 結果區域 */
    .result-section {
      background: #e8f4ff;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .result-section p {
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* 響應式調整 */
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      .container {
        padding: 15px;
      }
      
      select, input[type="text"], input[type="button"] {
        padding: 10px;
        font-size: 14px;
      }
    }

    /* 數字輸入容器 */
    .number-input-container {
      position: relative;
    }

    .number-input-container input {
      padding-right: 40px;
    }

    .clear-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      font-size: 18px;
      color: #999;
      cursor: pointer;
      display: none;
    }

    input:not(:placeholder-shown) + .clear-btn {
      display: block;
    }
  </style>
  <script src="station.js"></script>
</head>

<body>
  <div class="container">
    <h3>Luen Hing Survey Program</h3>
    <p style="text-align: center; color: #666;">Email: kin525@yahoo.com.hk</p>

    <form name="STN" id="surveyForm">
      <div class="form-group">
        <label for="contractSelect">Contract Number:</label>
        <select id="contractSelect" name="contact">
          <option value="Select Site">Select Site</option>
        </select>
      </div>

      <fieldset>
        <legend>From Station</legend>
        <div class="form-group">
          <select id="fromStationSelect" name="staionselect1">
            <option value="Station Name">Station Name</option>
          </select>
        </div>
        
        <div class="number-input-container">
          <label for="stnInput">ST.N :</label>
          <input id="stnInput" name="text2" type="text" inputmode="decimal" pattern="[0-9.]*" placeholder="Enter coordinates" size="12">
          <button type="button" class="clear-btn" onclick="clearInput('stnInput')">×</button>
        </div>
        
        <div class="number-input-container">
          <label for="steInput">ST.E :</label>
          <input id="steInput" name="text3" type="text" inputmode="decimal" pattern="[0-9.]*" placeholder="Enter coordinates" size="12">
          <button type="button" class="clear-btn" onclick="clearInput('steInput')">×</button>
        </div>
        
        <input type="button" value="CALL FROM SINSECTION" onclick="CALLSINDATA()">
      </fieldset>

      <fieldset>
        <legend>To Station</legend>
        <div class="form-group">
          <select id="toStationSelect" name="staionselect2">
            <option value="Station Name">Station Name</option>
          </select>
        </div>
        
        <div class="number-input-container">
          <label for="nxInput">Nx :</label>
          <input id="nxInput" name="text5" type="text" inputmode="decimal" pattern="[0-9.]*" placeholder="Enter coordinates" size="12">
          <button type="button" class="clear-btn" onclick="clearInput('nxInput')">×</button>
        </div>
        
        <div class="number-input-container">
          <label for="exInput">Ex :</label>
          <input id="exInput" name="text6" type="text" inputmode="decimal" pattern="[0-9.]*" placeholder="Enter coordinates" size="12">
          <button type="button" class="clear-btn" onclick="clearInput('exInput')">×</button>
        </div>
        
        <input type="button" value="CALL ANSWER" onclick="CALL_ANSWER()">
      </fieldset>

      <input type="button" value="RUN CALCULATION" onclick="RUNIt()">

      <div class="result-section">
        <p>
          <span>BRG =</span>
          <input name="text7" type="text" size="12" readonly style="background: #f0f0f0;">
        </p>
        <p>
          <span>DIST =</span>
          <input name="text8" type="text" size="12" readonly style="background: #f0f0f0;">
          <input type="button" value="DIFF CHECK" onclick="DIST_C()" style="width: auto; padding: 8px 12px;">
        </p>
      </div>
    </form>
  </div>

  <!-- 數字鍵盤容器 -->
  <div id="numberPadOverlay" class="number-pad-overlay" style="display: none;">
    <div class="number-pad-container">
      <div class="number-pad-header">
        <span id="currentInputLabel">Enter Number</span>
        <button type="button" onclick="hideNumberPad()">×</button>
      </div>
      <div class="number-pad" id="numberPad">
        <!-- 數字鍵盤內容由JavaScript生成 -->
      </div>
    </div>
  </div>

  <script>
    // 基礎功能保持不變，但改進事件處理
    let currentInputElement = null;

    function functionfirst() {
      let contractnumber = [];
      let j = 0;
      let temp = "";

      contractnumber[0] = st[1][0];

      for (let i = 2; i < st.length; i++) {
        temp = st[i][0];
        if (temp !== contractnumber[j]) {
          j++;
          contractnumber[j] = temp;
        }
      }

      let z = 0;
      for (let i = contractnumber.length - 1; i > 0; i--) {
        for (let j = i - 1; j >= 0; j--) {
          if (contractnumber[i] === contractnumber[j]) {
            z++;
            contractnumber[i] = "";
            break;
          }
        }
      }

      j = 0;
      for (let i = 0; i < contractnumber.length; i++) {
        if (contractnumber[i] !== "") {
          contractnumber[j] = contractnumber[i];
          j++;
        }
      }

      let F = contractnumber.length - z;
      const contractSelect = document.getElementById('contractSelect');
      
      for (let i = 0; i < F; i++) {
        const option = new Option(contractnumber[i], contractnumber[i]);
        contractSelect.add(option);
      }
    }

    // 其他原有函數保持不變，但添加現代事件監聽
    document.addEventListener('DOMContentLoaded', function() {
      // 初始化
      functionfirst();
      
      // 添加事件監聽器
      document.getElementById('contractSelect').addEventListener('change', function() {
        CheckIt3(this.selectedIndex);
      });
      
      document.getElementById('fromStationSelect').addEventListener('change', CheckIt1);
      document.getElementById('toStationSelect').addEventListener('change', CheckIt2);
      
      // 為數字輸入框添加數字鍵盤觸發
      const numberInputs = document.querySelectorAll('input[inputmode="decimal"]');
      numberInputs.forEach(input => {
        input.addEventListener('focus', function() {
          showNumberPad(this);
        });
      });
      
      // 初始化數字鍵盤
      initNumberPad();
    });

    // 數字鍵盤功能
    function initNumberPad() {
      const numberPad = document.getElementById('numberPad');
      const buttons = [
        '7', '8', '9',
        '4', '5', '6', 
        '1', '2', '3',
        '0', '.', '⌫'
      ];
      
      buttons.forEach(value => {
        const button = document.createElement('button');
        button.textContent = value;
        button.className = 'num-btn';
        button.onclick = () => handleNumberInput(value);
        numberPad.appendChild(button);
      });
    }

    function showNumberPad(inputElement) {
      currentInputElement = inputElement;
      document.getElementById('currentInputLabel').textContent = 'Enter ' + inputElement.previousElementSibling.textContent.trim();
      document.getElementById('numberPadOverlay').style.display = 'block';
    }

    function hideNumberPad() {
      document.getElementById('numberPadOverlay').style.display = 'none';
      currentInputElement = null;
    }

    function handleNumberInput(value) {
      if (!currentInputElement) return;
      
      if (value === '⌫') {
        currentInputElement.value = currentInputElement.value.slice(0, -1);
      } else if (value === '.' && currentInputElement.value.includes('.')) {
        // 防止多個小數點
        return;
      } else {
        currentInputElement.value += value;
      }
    }

    function clearInput(inputId) {
      document.getElementById(inputId).value = '';
    }

    // 原有函數保持不變
    function CheckIt3(index) {
      let contactno = document.STN.contact.value;
      let countnumber = 1;
      let temp = "";
      let j = 1;

      const fromSelect = document.getElementById('fromStationSelect');
      const toSelect = document.getElementById('toStationSelect');
      
      // 清空現有選項
      fromSelect.innerHTML = '<option value="Station Name">Station Name</option>';
      toSelect.innerHTML = '<option value="Station Name">Station Name</option>';

      for (let i = 0; i < st.length; i++) {
        temp = st[i][0];
        if (temp === contactno) {
          countnumber++;
          fromSelect.add(new Option(st[i][1], st[i][1]));
          toSelect.add(new Option(st[i][1], st[i][1]));
          j++;
        }
      }
    }

    function checkst(stationname, contactno) {
      let k = 0;
      for (let i = 1; i < st.length; i++) {
        let c = st[i][1];
        let d = st[i][0];
        if (c === stationname && d === contactno) {
          k = i;
        }
      }
      return k;
    }

    function CheckIt1() {
      let Name = document.STN.staionselect1.value;
      let contactno = document.STN.contact.value;
      let k = checkst(Name, contactno);
      document.STN.text2.value = st[k][2];
      document.STN.text3.value = st[k][3];
    }

    function CheckIt2() {
      let Name = document.STN.staionselect2.value;
      let contactno = document.STN.contact.value;
      let k = checkst(Name, contactno);
      document.STN.text5.value = st[k][2];
      document.STN.text6.value = st[k][3];
    }

    function RUNIt() {
      let stn = parseFloat(document.STN.text2.value);
      let ste = parseFloat(document.STN.text3.value);
      let nx = parseFloat(document.STN.text5.value);
      let ex = parseFloat(document.STN.text6.value);

      let brg = joint(stn, ste, nx, ex);
      let dist = jointdist(stn, ste, nx, ex);
      brg = dmscode(brg);
      dist = fix3(dist);

      document.STN.text7.value = brg;
      document.STN.text8.value = dist;
    }

    function fix3(z) {
      return Math.floor(z * 1000 + 0.5) / 1000;
    }

    function dmscode(z) {
      let d = Math.floor(z);
      let m = Math.floor((z - d) * 60);
      let s = Math.floor((((z - d) * 60 - m) * 60) * 10 + 0.5) / 10;

      if (s >= 60) {
        s -= 60;
        m += 1;
      }
      if (m >= 60) {
        m -= 60;
        d += 1;
      }

      return `${d}^${m}'${s}"`;
    }

    function jointdist(n, e, n2, e2) {
      let x = n2 - n;
      let y = e2 - e;
      return Math.sqrt(x * x + y * y);
    }

    function joint(n, e, n2, e2) {
      let x = n2 - n + 1e-12;
      let y = e2 - e;
      let brg = Math.atan(y / x) * 180 / Math.PI;
      if (x < 0) brg += 180;
      if (brg < 0) brg += 360;
      return brg;
    }

    function CALLSINDATA() {
      document.STN.text2.value = localStorage.XXN || '';
      document.STN.text3.value = localStorage.XXE || '';
    }

    function CALL_ANSWER() {
      document.STN.text5.value = localStorage.JOINT_N || '';
      document.STN.text6.value = localStorage.JOINT_E || '';
    }

    function DIST_C() {
      let HD = parseFloat(prompt("INPUT HD", ""));
      if (isNaN(HD)) return;
      
      let DIST = parseFloat(document.STN.text8.value);
      if (isNaN(DIST)) {
        alert("Please calculate DIST first");
        return;
      }
      
      let a = fix3(DIST - HD);
      alert("DIFF = " + a);
    }
  </script>

  <style>
    /* 數字鍵盤樣式 */
    .number-pad-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      display: flex;
      align-items: flex-end;
    }

    .number-pad-container {
      background: white;
      width: 100%;
      border-radius: 20px 20px 0 0;
      padding: 20px;
    }

    .number-pad-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }

    .number-pad-header button {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }

    .number-pad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .num-btn {
      aspect-ratio: 1;
      font-size: 20px;
      border: none;
      border-radius: 8px;
      background: #f0f0f0;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .num-btn:active {
      background: #ddd;
    }

    @media (min-width: 768px) {
      .number-pad-overlay {
        align-items: center;
        justify-content: center;
      }
      
      .number-pad-container {
        width: 300px;
        border-radius: 12px;
      }
    }
  </style>
</body>
</html>