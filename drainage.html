<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="ROBOTS" content="NOARCHIVE">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Luen Hing Survey Program - Drainage Calculation</title>
    <style>
        /* Base reset and responsive design */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 15px;
            line-height: 1.6;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h3 {
            text-align: center;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 24px;
        }

        p {
            margin-bottom: 15px;
        }

        /* Form elements */
        select, input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
            -webkit-appearance: none;
            appearance: none;
            background: white;
        }

        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: #007AFF;
        }

        /* Optimize number input for mobile */
        input[type="text"][inputmode="decimal"] {
            -webkit-user-select: text;
            user-select: text;
        }

        /* iOS Safari optimizations */
        @supports (-webkit-touch-callout: none) {
            input[type="text"][inputmode="decimal"] {
                font-size: 16px; /* Prevent zoom on iOS */
            }
        }

        fieldset {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            background: #fafafa;
        }

        legend {
            font-weight: bold;
            padding: 0 10px;
            color: #555;
        }

        /* Buttons */
        input[type="button"] {
            width: 100%;
            padding: 12px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-bottom: 10px;
        }

        input[type="button"]:active {
            background: #0056cc;
            transform: scale(0.98);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .button-group input[type="button"] {
            flex: 1;
        }

        .danger-button {
            background: #ff3b30 !important;
        }

        .success-button {
            background: #34c759 !important;
        }

        /* Result section */
        .result-section {
            background: #e8f4ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
            }
            
            select, input[type="text"], input[type="button"] {
                padding: 10px;
                font-size: 14px;
            }
        }

        /* Number input container */
        .number-input-container {
            position: relative;
        }

        .number-input-container input {
            padding-right: 40px;
        }

        .clear-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 18px;
            color: #999;
            cursor: pointer;
            display: none;
            padding: 5px;
            z-index: 10;
        }

        input:not(:placeholder-shown) + .clear-btn {
            display: block;
        }

        /* Form labels */
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        /* Compact layout for coordinate inputs */
        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .input-group {
            flex: 1;
        }

        .input-group label {
            font-size: 14px;
            margin-bottom: 3px;
        }

        /* Section headers */
        .section-header {
            background: #f0f0f0;
            padding: 8px 15px;
            margin: 20px 0 15px 0;
            border-radius: 6px;
            font-weight: bold;
            color: #555;
            text-align: center;
        }
    </style>
    <script src="station.js"></script>
    <script src="drainage.js"></script>
    <script src="drainage_DATA.js"></script>
</head>

<body>
    <div class="container">
        <h3>Kin Write Drainage</h3>
        <p style="text-align: center; color: #666;">Email: kin525@yahoo.com.hk</p>

        <form name="STN" id="surveyForm">
            <div class="form-group">
                <label for="contractSelect">Contract Number:</label>
                <select id="contractSelect" name="contact">
                    <option value="Select Site">Select Site</option>
                </select>
            </div>

            <fieldset>
                <legend>Instrument Station</legend>
                <div class="form-group">
                    <label for="stationSelect1">Station:</label>
                    <select id="stationSelect1" name="staionselect1">
                        <option value="Station Name">Station Name</option>
                    </select>
                </div>
                
                <div class="input-row">
                    <div class="input-group">
                        <label for="stnInput">STN:</label>
                        <div class="number-input-container">
                            <input id="stnInput" name="text2" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter STN"
                                   size="12">
                            <button type="button" class="clear-btn" onclick="clearInput('stnInput')">×</button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="steInput">STE:</label>
                        <div class="number-input-container">
                            <input id="steInput" name="text3" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter STE"
                                   size="12">
                            <button type="button" class="clear-btn" onclick="clearInput('steInput')">×</button>
                        </div>
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label for="rlInput">RL:</label>
                        <div class="number-input-container">
                            <input id="rlInput" name="text4" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter RL"
                                   size="4">
                            <button type="button" class="clear-btn" onclick="clearInput('rlInput')">×</button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="hiInput">HI:</label>
                        <div class="number-input-container">
                            <input id="hiInput" name="text5" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter HI"
                                   size="4">
                            <button type="button" class="clear-btn" onclick="clearInput('hiInput')">×</button>
                        </div>
                    </div>
                </div>
                
                <input type="button" value="CALL FROM SINSECTION" onclick="CALLSINDATA()">
                
                <div class="input-row">
                    <div class="input-group">
                        <label for="bstbInput">BS T/Brg:</label>
                        <div class="number-input-container">
                            <input id="bstbInput" name="text6" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter BS T/Brg"
                                   size="10">
                            <button type="button" class="clear-btn" onclick="clearInput('bstbInput')">×</button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="bsbInput">BS Brg:</label>
                        <div class="number-input-container">
                            <input id="bsbInput" name="text7" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter BS Brg"
                                   size="10">
                            <button type="button" class="clear-btn" onclick="clearInput('bsbInput')">×</button>
                        </div>
                    </div>
                </div>
            </fieldset>

            <fieldset>
                <legend>Drainage Pipe Data</legend>
                <div class="form-group">
                    <label for="drainageSelect">Manhole Data:</label>
                    <select id="drainageSelect" name="staionselect4">
                        <option value="Manhole Data">Manhole Data</option>
                    </select>
                </div>
                
                <div class="button-group">
                    <input type="button" value="ADD DRAINAGE DATA" onclick="RUNIt6()" class="success-button">
                    <input type="button" value="DELETE DATA" onclick="RUNIt7()" class="danger-button">
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label for="fromMhInput">FROM M/H:</label>
                        <div class="number-input-container">
                            <input id="fromMhInput" name="text26" type="text" 
                                   readonly
                                   placeholder="From Manhole"
                                   size="8">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="pipeSizeInput">PIPE SIZE:</label>
                        <div class="number-input-container">
                            <input id="pipeSizeInput" name="text27" type="text" 
                                   readonly
                                   placeholder="Pipe Size"
                                   size="8">
                        </div>
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label for="startPipeNInput">Start-Pipe N:</label>
                        <div class="number-input-container">
                            <input id="startPipeNInput" name="text15" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter N"
                                   size="12">
                            <button type="button" class="clear-btn" onclick="clearInput('startPipeNInput')">×</button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="startPipeEInput">Start-Pipe E:</label>
                        <div class="number-input-container">
                            <input id="startPipeEInput" name="text16" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter E"
                                   size="12">
                            <button type="button" class="clear-btn" onclick="clearInput('startPipeEInput')">×</button>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label for="startPipeILInput">Start-Pipe IL:</label>
                    <div class="number-input-container">
                        <input id="startPipeILInput" name="text17" type="text" 
                               inputmode="decimal" 
                               pattern="[0-9.]*" 
                               placeholder="Enter IL"
                               size="12">
                        <button type="button" class="clear-btn" onclick="clearInput('startPipeILInput')">×</button>
                    </div>
                </div>

                <div class="input-group">
                    <label for="toMhInput">TO M/H:</label>
                    <div class="number-input-container">
                        <input id="toMhInput" name="text28" type="text" 
                               readonly
                               placeholder="To Manhole"
                               size="8">
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label for="endPipeNInput">End-Pipe N:</label>
                        <div class="number-input-container">
                            <input id="endPipeNInput" name="text18" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter N"
                                   size="12">
                            <button type="button" class="clear-btn" onclick="clearInput('endPipeNInput')">×</button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="endPipeEInput">End-Pipe E:</label>
                        <div class="number-input-container">
                            <input id="endPipeEInput" name="text19" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter E"
                                   size="12">
                            <button type="button" class="clear-btn" onclick="clearInput('endPipeEInput')">×</button>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label for="endPipeILInput">End-Pipe IL:</label>
                    <div class="number-input-container">
                        <input id="endPipeILInput" name="text20" type="text" 
                               inputmode="decimal" 
                               pattern="[0-9.]*" 
                               placeholder="Enter IL"
                               size="12">
                        <button type="button" class="clear-btn" onclick="clearInput('endPipeILInput')">×</button>
                    </div>
                </div>
            </fieldset>

            <fieldset>
                <legend>Setting Out Input Data</legend>
                <div class="input-row">
                    <div class="input-group">
                        <label for="brgInput">Brg:</label>
                        <div class="number-input-container">
                            <input id="brgInput" name="text8" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter bearing"
                                   size="12">
                            <button type="button" class="clear-btn" onclick="clearInput('brgInput')">×</button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="vaInput">VA:</label>
                        <div class="number-input-container">
                            <input id="vaInput" name="text9" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter VA"
                                   size="12">
                            <button type="button" class="clear-btn" onclick="clearInput('vaInput')">×</button>
                        </div>
                    </div>
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label for="sdistInput">S.Dist:</label>
                        <div class="number-input-container">
                            <input id="sdistInput" name="text10" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter slope distance"
                                   size="10">
                            <button type="button" class="clear-btn" onclick="clearInput('sdistInput')">×</button>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="phInput">PH:</label>
                        <div class="number-input-container">
                            <input id="phInput" name="text11" type="text" 
                                   inputmode="decimal" 
                                   pattern="[0-9.]*" 
                                   placeholder="Enter PH"
                                   size="8">
                            <button type="button" class="clear-btn" onclick="clearInput('phInput')">×</button>
                        </div>
                    </div>
                </div>
                
                <input type="button" value="RUN CALCULATION" onclick="RUNIt()">
            </fieldset>

            <fieldset>
                <legend>NEL Input Data</legend>
                <div class="input-row">
                    <div class="input-group">
                        <label>Nx:</label>
                        <input name="text12" type="text" readonly style="background: #f0f0f0;">
                    </div>
                    
                    <div class="input-group">
                        <label>Ex:</label>
                        <input name="text13" type="text" readonly style="background: #f0f0f0;">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>RL:</label>
                    <input name="text14" type="text" readonly style="background: #f0f0f0;">
                </div>
                
                <div class="button-group">
                    <input type="button" value="RUN PIPE CALCULATION" onclick="RUNIt2()">
                    <input type="button" value="CLEAR DATA" onclick="CLSIt2()">
                </div>
            </fieldset>

            <fieldset>
                <legend>Pipe Calculation Results</legend>
                <div class="result-section">
                    <div class="input-group">
                        <label>TOTAL Pipe Length:</label>
                        <input name="text21" type="text" readonly style="background: #f0f0f0;">
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label>CH:</label>
                            <input name="text22" type="text" readonly style="background: #f0f0f0;">
                        </div>
                        
                        <div class="input-group">
                            <label>OS:</label>
                            <input name="text23" type="text" readonly style="background: #f0f0f0;">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label>Design IL:</label>
                        <input name="text24" type="text" readonly style="background: #f0f0f0;">
                    </div>
                    
                    <div class="input-group">
                        <label>Diff.:</label>
                        <input name="text25" type="text" readonly style="background: #f0f0f0;">
                    </div>
                </div>
            </fieldset>
        </form>
    </div>

    <script>
        // Input handling functions
        function clearInput(inputId) {
            const input = document.getElementById(inputId);
            input.value = '';
            
            // Trigger input event
            const event = new Event('input', { bubbles: true });
            input.dispatchEvent(event);
        }

        // Initialize clear button visibility
        function initClearButtons() {
            const inputs = document.querySelectorAll('input[inputmode="decimal"]');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    const clearBtn = this.nextElementSibling;
                    if (clearBtn && clearBtn.classList.contains('clear-btn')) {
                        clearBtn.style.display = this.value ? 'block' : 'none';
                    }
                });
            });
        }

        // Original functions with modern improvements
        function functionfirst() {
            // Initialize drainage data
            var DrainageName = new Array();
            var j = 1;
            
            for(var i = 1; i < Drainageinput.length; i++) {
                DrainageName[i] = Drainageinput[i][0] + " > TO > " + Drainageinput[i][5];
                document.STN.staionselect4[j] = new Option(DrainageName[i], i);
                j = j + 1;
            }

            // Initialize contract numbers
            var contractnumber = new Array();
            j = 0;
            var temp = "";
            
            contractnumber[0] = st[1][0];
            
            for(var i = 2; i < st.length; i++) {
                temp = st[i][0];
                if (temp != contractnumber[j]) {
                    j = j + 1;
                    contractnumber[j] = temp;
                }
            }

            var z = 0;
            for(var i = contractnumber.length - 1; i > 0; i--) {
                for(var j = i - 1; j > -1; j--) {
                    if (contractnumber[i] == contractnumber[j]) {
                        z = z + 1;
                        contractnumber[i] = "";
                        break;
                    }
                }
            }

            j = 0;
            for(var i = 0; i < contractnumber.length; i++) {
                if (contractnumber[i] != "") {
                    contractnumber[j] = contractnumber[i];
                    j = j + 1;
                }
            }

            var F = contractnumber.length - z;
            const contractSelect = document.getElementById('contractSelect');
            
            // Clear existing options
            contractSelect.innerHTML = '<option value="Select Site">Select Site</option>';
            
            for(var i = 0; i < F; i++) {
                const option = new Option(contractnumber[i], contractnumber[i]);
                contractSelect.add(option);
            }
        }

        function CheckIt4() {
            var k = document.STN.staionselect4.value;
            
            var ma1 = Drainageinput[k][0];
            var PIPE = Drainageinput[k][1];
            var STN = Drainageinput[k][2];
            var STE = Drainageinput[k][3];
            var STIL = Drainageinput[k][4];
            var ma2 = Drainageinput[k][5];
            var EN = Drainageinput[k][6];
            var EE = Drainageinput[k][7];
            var EIL = Drainageinput[k][8];

            document.STN.text26.value = ma1;
            document.STN.text27.value = PIPE;
            document.STN.text15.value = STN;
            document.STN.text16.value = STE;
            document.STN.text17.value = STIL;
            document.STN.text28.value = ma2;
            document.STN.text18.value = EN;
            document.STN.text19.value = EE;
            document.STN.text20.value = EIL;
        }

        function CheckIt3(index) {
            var contactno = document.STN.contact.value;
            var countnumber = 1;
            var temp = "";
            var j = 1;

            const stationSelect1 = document.getElementById('stationSelect1');
            
            // Clear existing options
            stationSelect1.innerHTML = '<option value="Station Name">Station Name</option>';

            for(var i = 0; i < st.length; i++) {
                temp = st[i][0];
                if (temp == contactno) {
                    countnumber = countnumber + 1;
                    stationSelect1.add(new Option(st[i][1], st[i][1]));
                    j = j + 1;
                }
            }
            stationSelect1.length = countnumber;
        }

        function CheckIt1() {
            var k = 1;
            var Name = document.STN.staionselect1.value;
            var contactno = document.STN.contact.value;
            k = checkst(Name, contactno);
            var n = st[k][2];
            var e = st[k][3];
            var rl = st[k][4];
            document.STN.text2.value = n;
            document.STN.text3.value = e;
            document.STN.text4.value = rl;
        }

        function checkst(stationname, contactno) {
            var k = 0;
            for (var i = 1; i < st.length; i++) {
                var c = st[i][1];
                var d = st[i][0];
                if (c == stationname && d == contactno) {
                    k = i;
                }
            }
            return k;
        }

        function CLSIt2() {
            document.STN.text8.value = "";
            document.STN.text9.value = "";
            document.STN.text10.value = "";
            document.STN.text12.value = "";
            document.STN.text13.value = "";
            document.STN.text14.value = "";
            document.STN.text21.value = "";
            document.STN.text22.value = "";
            document.STN.text23.value = "";
            document.STN.text24.value = "";
            document.STN.text25.value = "";
        }

        function RUNIt() {
            var stn = parseFloat(document.STN.text2.value) || 0;
            var ste = parseFloat(document.STN.text3.value) || 0;
            var SRL = parseFloat(document.STN.text4.value) || 0;
            var HI = parseFloat(document.STN.text5.value) || 0;
            var BSTB = parseFloat(document.STN.text6.value) || 0;
            var BSB = parseFloat(document.STN.text7.value) || 0;
            var BRG = parseFloat(document.STN.text8.value) || 0;
            var VA = parseFloat(document.STN.text9.value) || 0;
            var SD = parseFloat(document.STN.text10.value) || 0;
            var PH = parseFloat(document.STN.text11.value) || 0;

            var COLL = fix4(SRL) + fix4(HI);
            VA = deg(VA);
            var RL = fcos(VA) * SD + fix4(COLL) - fix3(PH);
            var HD = (Math.abs(fsin(VA) * SD));
            var TB = deg(BSTB) - deg(BSB) + deg(BRG);
            var NX = fcos(TB) * HD + fix4(stn);
            var EX = fsin(TB) * HD + fix4(ste);
            
            document.STN.text12.value = fix4(NX);
            document.STN.text13.value = fix4(EX);
            document.STN.text14.value = fix3(RL);
        }

        function RUNIt2() {
            var PN1 = parseFloat(document.STN.text15.value) || 0;
            var PE1 = parseFloat(document.STN.text16.value) || 0;
            var IL1 = parseFloat(document.STN.text17.value) || 0;
            var PN2 = parseFloat(document.STN.text18.value) || 0;
            var PE2 = parseFloat(document.STN.text19.value) || 0;
            var IL2 = parseFloat(document.STN.text20.value) || 0;
            
            var PipeL = jointdist(PN1, PE1, PN2, PE2);
            var Pipebrg = dms(joint(PN1, PE1, PN2, PE2));
            
            document.STN.text21.value = fix3(PipeL);
            
            var Fall = (fix3(IL1) - fix3(IL2)) / PipeL;
            var RN = parseFloat(document.STN.text12.value) || 0;
            var RE = parseFloat(document.STN.text13.value) || 0;
            var RRL = parseFloat(document.STN.text14.value) || 0;

            var CH = fix3(linech(PN1, PE1, 0, Pipebrg, RN, RE));
            var OS = fix3(lineos(PN1, PE1, 0, Pipebrg, RN, RE));
            var IL = fix3(IL1) - (fix3(CH) * Fall);
            var Diff = fix3(fix3(RRL) - fix3(IL));

            if (Diff < 0) {
                Diff = "UP " + Diff;
            } else {
                Diff = "Down " + Diff;
            }

            document.STN.text22.value = CH;
            document.STN.text23.value = OS;
            document.STN.text24.value = fix3(IL);
            document.STN.text25.value = Diff;
        }

        function RUNIt6() {
            window.location = "Add DrainageData.html";
        }

        function RUNIt7() {
            var password = prompt("PASSWORD", "");
            if (password == "94830635") {
                var Stationno = document.STN.staionselect4.value;
                var mh1 = document.STN.text26.value;
                var pipe = document.STN.text27.value;
                var stn = document.STN.text15.value;
                var ste = document.STN.text16.value;
                var stil = document.STN.text17.value;
                var mh2 = document.STN.text28.value;
                var en = document.STN.text18.value;
                var ee = document.STN.text19.value;
                var eil = document.STN.text20.value;

                window.location.href = "drainage_delete.php?Stationno=" + Stationno + "&Manhole1=" + mh1 + "&Pipe=" + pipe + "&StN=" + stn + "&StE=" + ste + 
                    "&StIL=" + stil + "&Manhole2=" + mh2 + "&EN=" + en + "&EE=" + ee + "&EIL=" + eil;
            } else {
                return;
            }
        }

        function CALLSINDATA() {
            document.STN.text2.value = localStorage.XXN || '';
            document.STN.text3.value = localStorage.XXE || '';
            document.STN.text4.value = localStorage.XXL || '';
            document.STN.text5.value = 0;
        }

        // Helper functions (assuming they are defined in drainage.js)
        function fix3(z) {
            return z = (Math.floor(z * 1000 + 0.5)) / 1000;
        }

        function fix4(z) {
            return z = (Math.floor(z * 10000 + 0.5)) / 10000;
        }

        function deg(z) {
            return z = (Math.floor(z)) + (Math.floor((z - (Math.floor(z))) * 100)) / 60 + ((100 * z - (Math.floor(100 * z))) * 100) / 3600;
        }

        function fsin(z) {
            return z = (Math.sin(z * 3.14159265358979 / 180));
        }

        function fcos(z) {
            return z = (Math.cos(z * 3.14159265358979 / 180));
        }

        function jointdist(n, e, n2, e2) {
            var x = n2 - n;
            var y = e2 - e;
            return Math.sqrt(x * x + y * y);
        }

        function joint(n, e, n2, e2) {
            var x = n2 - n + 1e-12;
            var y = e2 - e;
            var brg = Math.atan(y / x) * 180 / Math.PI;
            if (x < 0) brg += 180;
            if (brg < 0) brg += 360;
            return brg;
        }

        function dms(z) {
            var d = Math.floor(z);
            var m = Math.floor((z - d) * 60);
            var s = Math.floor((((z - d) * 60 - m) * 60) * 10 + 0.5) / 10;

            if (s >= 60) {
                s -= 60;
                m += 1;
            }
            if (m >= 60) {
                m -= 60;
                d += 1;
            }

            return `${d}^${m}'${s}"`;
        }

        // Page load initialization
        document.addEventListener('DOMContentLoaded', function() {
            functionfirst();
            initClearButtons();
            
            // Add event listeners
            document.getElementById('contractSelect').addEventListener('change', function() {
                CheckIt3(this.selectedIndex);
            });
            
            document.getElementById('stationSelect1').addEventListener('change', CheckIt1);
            document.getElementById('drainageSelect').addEventListener('change', CheckIt4);
        });
    </script>
</body>
</html>