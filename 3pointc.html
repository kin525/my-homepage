<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circle Calculator - 3 & 4 Points</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --border-radius: 12px;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 25px 20px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 25px;
        }
        
        .visualization {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .circle-image {
            width: 200px;
            height: 150px;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
        }
        
        .circle-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .formula {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark);
            padding: 10px;
            background-color: var(--light);
            border-radius: 8px;
        }
        
        .input-section {
            margin-bottom: 20px;
        }
        
        .point-group {
            margin-bottom: 25px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .point-title {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-row {
            display: flex;
            gap: 15px;
        }
        
        .input-group {
            flex: 1;
            position: relative;
        }
        
        .input-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        .input-container {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px 40px 12px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
            background-color: white;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }
        
        .clear-btn {
            position: absolute;
            right: 12px;
            background: none;
            border: none;
            color: var(--gray);
            font-size: 16px;
            cursor: pointer;
            display: none;
            padding: 4px;
            transition: var(--transition);
        }
        
        input:not(:placeholder-shown) + .clear-btn {
            display: block;
        }
        
        .clear-btn:hover {
            color: var(--dark);
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-calculate {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-calculate:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-clear {
            background-color: #f1f3f5;
            color: var(--dark);
        }
        
        .btn-clear:hover {
            background-color: #e9ecef;
            transform: translateY(-2px);
        }
        
        .results-section {
            margin-top: 30px;
        }
        
        .section-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 1.2rem;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--light);
        }
        
        .result-group {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .result-row {
            display: flex;
            gap: 15px;
            margin-bottom: 12px;
        }
        
        .result-item {
            flex: 1;
        }
        
        .result-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        .result-value {
            width: 100%;
            padding: 10px 12px;
            background-color: white;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 16px;
            color: var(--dark);
        }
        
        .circle-result {
            margin-bottom: 15px;
            padding: 12px;
            background-color: white;
            border-radius: 6px;
            border-left: 4px solid var(--primary);
        }
        
        .circle-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .circle-data {
            display: flex;
            gap: 15px;
        }
        
        .circle-data-item {
            flex: 1;
        }
        
        .average-circle {
            background-color: #e7f5ff;
            border-left: 4px solid var(--success);
        }
        
        .footer {
            text-align: center;
            padding: 15px;
            background-color: var(--light);
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .instructions {
            margin-top: 15px;
            padding: 12px;
            background-color: #e7f5ff;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--dark);
        }
        
        .toggle-section {
            display: flex;
            margin-bottom: 20px;
            background-color: #f1f3f5;
            border-radius: 8px;
            padding: 5px;
        }
        
        .toggle-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: none;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .toggle-btn.active {
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        @media (max-width: 768px) {
            .input-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .result-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .circle-data {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                border-radius: 10px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .content {
                padding: 20px 15px;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            input[type="text"] {
                padding: 12px 40px 12px 12px;
                font-size: 16px;
            }
        }
        
        /* iOS Safari specific optimizations */
        @supports (-webkit-touch-callout: none) {
            input[type="text"] {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Circle Calculator - 3 & 4 Points</h1>
            <p>Calculate circle center and radius from three or four points</p>
        </div>
        
        <div class="content">
            <div class="visualization">
                <div class="circle-image">
                    <!-- 使用原图像链接 -->
                    <img src="proof.jpg" alt="Circle Diagram">
                </div>
                <div class="formula">
                    Calculate circle center and radius from three or four points
                </div>
            </div>
            
            <div class="toggle-section">
                <button class="toggle-btn active" id="threePointsBtn">3 Points</button>
                <button class="toggle-btn" id="fourPointsBtn">4 Points</button>
            </div>
            
            <div class="input-section" id="threePointsInput">
                <div class="point-group">
                    <div class="point-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Point A
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">Northing (N)</label>
                            <div class="input-container">
                                <input type="text" id="aN" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter N coordinate">
                                <button class="clear-btn" onclick="clearInput('aN')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Easting (E)</label>
                            <div class="input-container">
                                <input type="text" id="aE" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter E coordinate">
                                <button class="clear-btn" onclick="clearInput('aE')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="point-group">
                    <div class="point-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Point B
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">Northing (N)</label>
                            <div class="input-container">
                                <input type="text" id="bN" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter N coordinate">
                                <button class="clear-btn" onclick="clearInput('bN')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Easting (E)</label>
                            <div class="input-container">
                                <input type="text" id="bE" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter E coordinate">
                                <button class="clear-btn" onclick="clearInput('bE')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="point-group">
                    <div class="point-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Point C
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">Northing (N)</label>
                            <div class="input-container">
                                <input type="text" id="cN" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter N coordinate">
                                <button class="clear-btn" onclick="clearInput('cN')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Easting (E)</label>
                            <div class="input-container">
                                <input type="text" id="cE" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter E coordinate">
                                <button class="clear-btn" onclick="clearInput('cE')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="instructions">
                    <i class="fas fa-info-circle"></i> Enter coordinates for three points to calculate the circle center and radius
                </div>
            </div>
            
            <div class="input-section" id="fourPointsInput" style="display: none;">
                <div class="point-group">
                    <div class="point-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Point A
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">Northing (N)</label>
                            <div class="input-container">
                                <input type="text" id="aN4" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter N coordinate">
                                <button class="clear-btn" onclick="clearInput('aN4')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Easting (E)</label>
                            <div class="input-container">
                                <input type="text" id="aE4" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter E coordinate">
                                <button class="clear-btn" onclick="clearInput('aE4')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="point-group">
                    <div class="point-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Point B
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">Northing (N)</label>
                            <div class="input-container">
                                <input type="text" id="bN4" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter N coordinate">
                                <button class="clear-btn" onclick="clearInput('bN4')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Easting (E)</label>
                            <div class="input-container">
                                <input type="text" id="bE4" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter E coordinate">
                                <button class="clear-btn" onclick="clearInput('bE4')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="point-group">
                    <div class="point-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Point C
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">Northing (N)</label>
                            <div class="input-container">
                                <input type="text" id="cN4" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter N coordinate">
                                <button class="clear-btn" onclick="clearInput('cN4')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Easting (E)</label>
                            <div class="input-container">
                                <input type="text" id="cE4" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter E coordinate">
                                <button class="clear-btn" onclick="clearInput('cE4')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="point-group">
                    <div class="point-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Point D
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label class="input-label">Northing (N)</label>
                            <div class="input-container">
                                <input type="text" id="dN4" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter N coordinate">
                                <button class="clear-btn" onclick="clearInput('dN4')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="input-group">
                            <label class="input-label">Easting (E)</label>
                            <div class="input-container">
                                <input type="text" id="dE4" inputmode="decimal" pattern="-?[0-9.]*" placeholder="Enter E coordinate">
                                <button class="clear-btn" onclick="clearInput('dE4')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="instructions">
                    <i class="fas fa-info-circle"></i> Enter coordinates for four points to calculate four circle centers and the average circle
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn-calculate" onclick="calculate()">
                    <i class="fas fa-calculator"></i>
                    Calculate
                </button>
                <button class="btn-clear" onclick="clearForm()">
                    <i class="fas fa-eraser"></i>
                    Clear All
                </button>
            </div>
            
            <div class="results-section">
                <div class="section-title">Calculation Results</div>
                
                <div id="threePointsResult">
                    <div class="result-group">
                        <div class="circle-result">
                            <div class="circle-title">Circle from Points A, B, C</div>
                            <div class="circle-data">
                                <div class="circle-data-item">
                                    <label class="result-label">Center N</label>
                                    <input type="text" id="centerN3" class="result-value" readonly>
                                </div>
                                <div class="circle-data-item">
                                    <label class="result-label">Center E</label>
                                    <input type="text" id="centerE3" class="result-value" readonly>
                                </div>
                                <div class="circle-data-item">
                                    <label class="result-label">Radius</label>
                                    <input type="text" id="radius3" class="result-value" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="fourPointsResult" style="display: none;">
                    <div class="result-group">
                        <div class="circle-result">
                            <div class="circle-title">Circle from Points A, B, C</div>
                            <div class="circle-data">
                                <div class="circle-data-item">
                                    <label class="result-label">Center N</label>
                                    <input type="text" id="centerABC_N" class="result-value" readonly>
                                </div>
                                <div class="circle-data-item">
                                    <label class="result-label">Center E</label>
                                    <input type="text" id="centerABC_E" class="result-value" readonly>
                                </div>
                                <div class="circle-data-item">
                                    <label class="result-label">Radius</label>
                                    <input type="text" id="radiusABC" class="result-value" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="circle-result">
                            <div class="circle-title">Circle from Points A, B, D</div>
                            <div class="circle-data">
                                <div class="circle-data-item">
                                    <label class="result-label">Center N</label>
                                    <input type="text" id="centerABD_N" class="result-value" readonly>
                                </div>
                                <div class="circle-data-item">
                                    <label class="result-label">Center E</label>
                                    <input type="text" id="centerABD_E" class="result-value" readonly>
                                </div>
                                <div class="circle-data-item">
                                    <label class="result-label">Radius</label>
                                    <input type="text" id="radiusABD" class="result-value" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="circle-result">
                            <div class="circle-title">Circle from Points A, C, D</div>
                            <div class="circle-data">
                                <div class="circle-data-item">
                                    <label class="result-label">Center N</label>
                                    <input type="text" id="centerACD_N" class="result-value" readonly>
                                </div>
                                <div class="circle-data-item">
                                    <label class="result-label">Center E</label>
                                    <input type="text" id="centerACD_E" class="result-value" readonly>
                                </div>
                                <div class="circle-data-item">
                                    <label class="result-label">Radius</label>
                                    <input type="text" id="radiusACD" class="result-value" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="circle-result">
                            <div class="circle-title">Circle from Points B, C, D</div>
                            <div class="circle-data">
                                <div class="circle-data-item">
                                    <label class="result-label">Center N</label>
                                    <input type="text" id="centerBCD_N" class="result-value" readonly>
                                </div>
                                <div class="circle-data-item">
                                    <label class="result-label">Center E</label>
                                    <input type="text" id="centerBCD_E" class="result-value" readonly>
                                </div>
                                <div class="circle-data-item">
                                    <label class="result-label">Radius</label>
                                    <input type="text" id="radiusBCD" class="result-value" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="circle-result average-circle">
                            <div class="circle-title">Average Circle</div>
                            <div class="circle-data">
                                <div class="circle-data-item">
                                    <label class="result-label">Center N</label>
                                    <input type="text" id="centerAvg_N" class="result-value" readonly>
                                </div>
                                <div class="circle-data-item">
                                    <label class="result-label">Center E</label>
                                    <input type="text" id="centerAvg_E" class="result-value" readonly>
                                </div>
                                <div class="circle-data-item">
                                    <label class="result-label">Radius</label>
                                    <input type="text" id="radiusAvg" class="result-value" readonly>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Email: kin525@yahoo.com.hk</p>
        </div>
    </div>

    <script>
        // Initialize clear button visibility
        function initClearButtons() {
            const inputs = document.querySelectorAll('input[type="text"]:not(.result-value)');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    const clearBtn = this.nextElementSibling;
                    if (clearBtn && clearBtn.classList.contains('clear-btn')) {
                        clearBtn.style.display = this.value ? 'block' : 'none';
                    }
                });
                
                // Initialize visibility on page load
                const clearBtn = input.nextElementSibling;
                if (clearBtn && clearBtn.classList.contains('clear-btn')) {
                    clearBtn.style.display = input.value ? 'block' : 'none';
                }
            });
        }
        
        // Clear a specific input
        function clearInput(inputId) {
            const input = document.getElementById(inputId);
            input.value = '';
            input.focus();
            
            // Hide the clear button
            const clearBtn = input.nextElementSibling;
            if (clearBtn && clearBtn.classList.contains('clear-btn')) {
                clearBtn.style.display = 'none';
            }
        }
        
        // Clear all inputs
        function clearForm() {
            // Clear input fields
            const inputs = document.querySelectorAll('input[type="text"]:not(.result-value)');
            inputs.forEach(input => {
                input.value = '';
            });
            
            // Clear result fields
            const results = document.querySelectorAll('.result-value');
            results.forEach(result => {
                result.value = '';
            });
            
            // Hide all clear buttons
            document.querySelectorAll('.clear-btn').forEach(btn => {
                btn.style.display = 'none';
            });
        }
        
        // Toggle between 3 and 4 points input
        document.getElementById('threePointsBtn').addEventListener('click', function() {
            document.getElementById('threePointsBtn').classList.add('active');
            document.getElementById('fourPointsBtn').classList.remove('active');
            document.getElementById('threePointsInput').style.display = 'block';
            document.getElementById('fourPointsInput').style.display = 'none';
            document.getElementById('threePointsResult').style.display = 'block';
            document.getElementById('fourPointsResult').style.display = 'none';
        });
        
        document.getElementById('fourPointsBtn').addEventListener('click', function() {
            document.getElementById('fourPointsBtn').classList.add('active');
            document.getElementById('threePointsBtn').classList.remove('active');
            document.getElementById('threePointsInput').style.display = 'none';
            document.getElementById('fourPointsInput').style.display = 'block';
            document.getElementById('threePointsResult').style.display = 'none';
            document.getElementById('fourPointsResult').style.display = 'block';
        });
        
        // Calculate the circle center and radius
        function calculate() {
            const isThreePoints = document.getElementById('threePointsBtn').classList.contains('active');
            
            if (isThreePoints) {
                calculateThreePoints();
            } else {
                calculateFourPoints();
            }
        }
        
        // Calculate for three points
        function calculateThreePoints() {
            // Get input values
            const n1 = parseFloat(document.getElementById('aN').value) || 0;
            const e1 = parseFloat(document.getElementById('aE').value) || 0;
            const n2 = parseFloat(document.getElementById('bN').value) || 0;
            const e2 = parseFloat(document.getElementById('bE').value) || 0;
            const n3 = parseFloat(document.getElementById('cN').value) || 0;
            const e3 = parseFloat(document.getElementById('cE').value) || 0;
            
            // Check if we have all three points
            if (!n1 || !e1 || !n2 || !e2 || !n3 || !e3) {
                alert('Please enter all three points with both N and E coordinates');
                return;
            }
            
            // Calculate circle center using the original formula
            const result = calculateCircleCenter(n1, e1, n2, e2, n3, e3);
            
            if (!result) {
                alert('Error: The three points are collinear and cannot form a circle');
                return;
            }
            
            // Display results
            document.getElementById('centerN3').value = fix3(result.cn);
            document.getElementById('centerE3').value = fix3(result.ce);
            document.getElementById('radius3').value = fix3(result.r);
        }
        
        // Calculate for four points
        function calculateFourPoints() {
            // Get input values
            const aN = parseFloat(document.getElementById('aN4').value) || 0;
            const aE = parseFloat(document.getElementById('aE4').value) || 0;
            const bN = parseFloat(document.getElementById('bN4').value) || 0;
            const bE = parseFloat(document.getElementById('bE4').value) || 0;
            const cN = parseFloat(document.getElementById('cN4').value) || 0;
            const cE = parseFloat(document.getElementById('cE4').value) || 0;
            const dN = parseFloat(document.getElementById('dN4').value) || 0;
            const dE = parseFloat(document.getElementById('dE4').value) || 0;
            
            // Check if we have all four points
            if (!aN || !aE || !bN || !bE || !cN || !cE || !dN || !dE) {
                alert('Please enter all four points with both N and E coordinates');
                return;
            }
            
            // Calculate circle centers for all combinations of three points
            const circles = [];
            
            // Combination 1: A, B, C
            const circle1 = calculateCircleCenter(aN, aE, bN, bE, cN, cE);
            if (circle1) {
                circles.push(circle1);
                document.getElementById('centerABC_N').value = fix3(circle1.cn);
                document.getElementById('centerABC_E').value = fix3(circle1.ce);
                document.getElementById('radiusABC').value = fix3(circle1.r);
            } else {
                document.getElementById('centerABC_N').value = 'Invalid';
                document.getElementById('centerABC_E').value = 'Invalid';
                document.getElementById('radiusABC').value = 'Invalid';
            }
            
            // Combination 2: A, B, D
            const circle2 = calculateCircleCenter(aN, aE, bN, bE, dN, dE);
            if (circle2) {
                circles.push(circle2);
                document.getElementById('centerABD_N').value = fix3(circle2.cn);
                document.getElementById('centerABD_E').value = fix3(circle2.ce);
                document.getElementById('radiusABD').value = fix3(circle2.r);
            } else {
                document.getElementById('centerABD_N').value = 'Invalid';
                document.getElementById('centerABD_E').value = 'Invalid';
                document.getElementById('radiusABD').value = 'Invalid';
            }
            
            // Combination 3: A, C, D
            const circle3 = calculateCircleCenter(aN, aE, cN, cE, dN, dE);
            if (circle3) {
                circles.push(circle3);
                document.getElementById('centerACD_N').value = fix3(circle3.cn);
                document.getElementById('centerACD_E').value = fix3(circle3.ce);
                document.getElementById('radiusACD').value = fix3(circle3.r);
            } else {
                document.getElementById('centerACD_N').value = 'Invalid';
                document.getElementById('centerACD_E').value = 'Invalid';
                document.getElementById('radiusACD').value = 'Invalid';
            }
            
            // Combination 4: B, C, D
            const circle4 = calculateCircleCenter(bN, bE, cN, cE, dN, dE);
            if (circle4) {
                circles.push(circle4);
                document.getElementById('centerBCD_N').value = fix3(circle4.cn);
                document.getElementById('centerBCD_E').value = fix3(circle4.ce);
                document.getElementById('radiusBCD').value = fix3(circle4.r);
            } else {
                document.getElementById('centerBCD_N').value = 'Invalid';
                document.getElementById('centerBCD_E').value = 'Invalid';
                document.getElementById('radiusBCD').value = 'Invalid';
            }
            
            // Calculate average center if we have at least one valid circle
            if (circles.length > 0) {
                let avgCN = 0;
                let avgCE = 0;
                let avgR = 0;
                
                circles.forEach(circle => {
                    avgCN += circle.cn;
                    avgCE += circle.ce;
                    avgR += circle.r;
                });
                
                avgCN /= circles.length;
                avgCE /= circles.length;
                avgR /= circles.length;
                
                // Display average results
                document.getElementById('centerAvg_N').value = fix3(avgCN);
                document.getElementById('centerAvg_E').value = fix3(avgCE);
                document.getElementById('radiusAvg').value = fix3(avgR);
            } else {
                alert('No valid circles could be calculated from the provided points');
            }
        }
        
        // Calculate circle center from three points
        function calculateCircleCenter(n1, e1, n2, e2, n3, e3) {
            const denominator = n1 * (e3 - e2) + n2 * (e1 - e3) + n3 * (e2 - e1);
            
            // Check if points are collinear
            if (Math.abs(denominator) < 0.0001) {
                return null;
            }
            
            const cn = (0.5 * ((e1*e1 + n1*n1) * (e3 - e2) + 
                              (e2*e2 + n2*n2) * (e1 - e3) + 
                              (e3*e3 + n3*n3) * (e2 - e1))) / denominator;
            
            const ce = (0.5 * ((e1*e1 + n1*n1) * (n3 - n2) + 
                              (e2*e2 + n2*n2) * (n1 - n3) + 
                              (e3*e3 + n3*n3) * (n2 - n1))) / 
                      (e1 * (n3 - n2) + e2 * (n1 - n3) + e3 * (n2 - n1));
            
            // Calculate radius
            const r = jointdist(n1, e1, cn, ce);
            
            return { cn, ce, r };
        }
        
        // Calculate distance between two points
        function jointdist(n, e, n2, e2) {
            const x = n2 - n;
            const y = e2 - e;
            return Math.sqrt(x*x + y*y);
        }
        
        // Round to 3 decimal places
        function fix3(z) {
            return (Math.floor(z * 1000 + 0.5)) / 1000;
        }
        
        // Add keyboard support
        document.addEventListener('DOMContentLoaded', function() {
            initClearButtons();
            
            const inputs = document.querySelectorAll('input[type="text"]:not(.result-value)');
            inputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        calculate();
                    }
                });
            });
        });
    </script>
</body>
</html>